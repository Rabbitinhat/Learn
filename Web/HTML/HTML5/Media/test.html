<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Learn HTML5</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <style rel="stylesheet">
        .info {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <!-- width height 控制元素大小  不设置时会显示原始尺寸 controls属性提供视频控件, 也可以使用JS& HTMLMediaElement创建 -->
    <!-- autoplay 设置视频自动播放 autoplay=false 并不能停止自动播放, 只能删除属性-->
    <!-- preload 预先载入视频 -->
    <!-- muted 静音 -->
    <!-- poster 预先载入图片 -->
    <video id="media" width="360" height="240" preload="metadata" poster="./good.jpeg">
        <!-- 由于不同浏览器支持不同视频格式? 使用source元素指定不同格式资源, type属性表示MIME类型 浏览器根据文件的MIME类型来确定是否可以播放-->
        <!-- track 为video提供外部文本track -->
        <!-- default 默认track kind="caption" 表明track类型(caption表示翻译) srclang "语言"-->
        <!-- Edge 会显示track控件 -->
        <track default kind="captions" srclang="en"
            src="https://interactive-examples.mdn.mozilla.net/media/examples/friday.vtt">
        <source src="./audiotest.webm" type="video/webm">
        <source src="./timessquare.mp4" type="video/mp4">
        <!-- 禁止使用video元素时显示 -->
        Sorry! your browser doesn't
        support embedded videos.
    </video>
    <input type="button" value="Play">
    <input type="button" value="Pause">
    <!-- 音频元素 -->
    <!-- chrome firefox会组织自动播放 IE11 Edge不会 -->
    <!--  -->
    <audio controls src="./audiotest.webm">
        <!-- source 提供多种支持格式 -->
        <!-- 可以使用<audio> 播放视频格式文件(只能听见声音); video同理-->
        <source src="./audiotest.webm" type="video/webm">
        <source src="./t-rex-roar.mp3" type="audio/ogg">
        Your brower doesn't support the <code>audio</code> element.
    </audio>
    <!-- HTMLMediaElement 属性 -->
    <table class="info" border="1">
        <tr>
            <th>Property</th>
            <th>Value</th>
        </tr>
    </table>
    <!-- canPlayType -->
    <table class="info" border="1">
        <tr>
            <th>Property</th>
            <th>Value</th>
        </tr>
    </table>

    <table class="info" border="1">
        <tr>
            <th>Property</th>
            <th>Value</th>
        </tr>
    </table>

    <div>
        <button id="pressme" type="button">Press Me</button>
    </div>
    <script>
        /* 使用HTMLMediaElement获取媒体元素信息 */
        var mediaElem = document.getElementById("media");
        var tableElem = document.getElementsByClassName("info")[0];

        /* volume get/set 音量 */
        var propertyNames = ["height", "width", "autoplay", "currentSrc", "controls", "loop", "muted", "preload", "src", "volume"];

        /* chrome & firefox currentSrc is null volume=1*/
        /* Edge volume=1 */
        for (let i = 0; i < propertyNames.length; i++) {
            tableElem.innerHTML +=
                "<tr><td>" + propertyNames[i] + "</td><td>" + mediaElem[propertyNames[i]] + "</td></th>";
        }

        /* 判断是否可以播放某一格式媒体 */
        var tableElem2 = document.getElementsByClassName("info")[1];
        let mediaFiles = ["audiotest.webm", "timessquare.ogv", "timessquare.mp4"];
        let mediaTypes = ["video/webm", "video/ogv", "video/mp4"];

        for (let i = 0; i < mediaTypes.length; i++) {
            /* 调用canPlayType() */
            let playable = mediaElem.canPlayType(mediaTypes[i]);
            if (!playable) {
                playable = "no";
            }

            /* chrome firefox Edge Opera -> maybe no maybe IE11-> no no maybe (似乎video src属性指向webm文件会无法播放, 但将其放入<source>中却可以正常播放) */
            tableElem2.innerHTML += "<tr><td>" + mediaTypes[i] + "</td><td>" + playable + "</td></tr>";
        }

        /* 控制媒体回放 */
        var tableElem3 = document.getElementsByClassName("info")[2];

        document.getElementById("pressme").onclick = displayValues;

        displayValues();

        function displayValues() {
            /* attr  */
            var propertyNames = ["currentTime", "duration", "paused", "ended"];
            tableElem3.innerHTML = "";
            for(let i=0; i<propertyNames.length; i++){
                tableElem3.innerHTML +=
                    "<tr><td>" + propertyNames[i] + "</td><td>" + mediaElem[propertyNames[i]] + "</td></tr>";
            }
        }

        /* 替换默认控件 */
        const buttons = document.querySelectorAll("input[type=\"button\"]");

        for(let i=0; i<buttons.length; i++){
            buttons[i].onclick = handleButtonPress;
        }

        function handleButtonPress(e){
            switch(e.target.value){
                case "Play": 
                    mediaElem.play();
                    break;
                case "Pause":
                    mediaElem.pause();
                    break;
            }
        }
    </script>
</body>

</html>