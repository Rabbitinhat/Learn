<!doctype html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8">
    <title>Web Storage</title>
    <meta name="author" content="chyon">
    <meta http-equiv="X-UA-Compablie" content="IE=Edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>

    </style>
</head>

<body>
    <div>
        <div><label>Key:</label><input type="text" id="key" placeholder="Enter Key"></div>
        <div><label for="">Value:</label><input type="text" id="value" placeholder="Enter Value"></div>
        <div id="button">
            <button id="add">Add</button>
            <button id="clear">Clear</button>
        </div>
        <p id="countmsg">There are <span id="count"></span>items.</p>
    </div>

    <table id="data">
        <tr>
            <th>Item Count:</th>
            <td id="count">-</td>
        </tr>
    </table>

    <table id="dataCh">
        <tr>
            <th>Key</th>
            <th>oldValue</th>
            <th>newValue</th>
            <th>url</th>
            <th>storageArea</th>
        </tr>
    </table>
    <script>
        let tableChElem = document.getElementById("dataCh");

        /* onstorage event */
        window.onstorage = handleStorage;
        console.log(tableChElem.innerHTML);
        function handleStorage(e) {
            let row = "<tr>";
            row += "<td>" + e.key + "</td>";
            row += "<td>" + e.oldValue + "</td>";
            row += "<td>" + e.newValue + "</td>";
            row += "<td>" + e.url + "</td>"
            row += "<td>" + (e.storageArea == localStorage) + "</td></tr>";
            console.log(row);
            tableChElem.innerHTML += row;
        };

        displayData();

        let buttons = document.getElementsByTagName("button");
        for (let i = 0; i < buttons.length; i++) {
            buttons[i].onclick = handleButtonPress;
        }

        function handleButtonPress(e) {
            switch (e.target.id) {
                case "add":
                    let key = document.getElementById("key").value;
                    let value = document.getElementById("value").value;
                    /* 调用localStorage.setItem() */
                    localStorage.setItem(key, value);
                    break;

                case "clear":
                    localStorage.clear();
                    break;
            }
            displayData();
        }

        function displayData() {
            let tableElem = document.getElementById("data");
            tableElem.innerHTML = "";
            let itemCount = localStorage.length;
            document.getElementById("count").innerHTML = itemCount;
            for (let i = 0; i < itemCount; i++) {
                let key = localStorage.key(i);
                let val = localStorage[key];
                tableElem.innerHTML += "<tr><th>" + key + ":</th><td>" + val + "</td></tr>";
            }
        }
    </script>
</body>

</html>