# Node/Express 入门

## 参考 摘抄 

[Node.js是什么?](https://www.ibm.com/developerworks/cn/opensource/os-nodejs/)

## Node.js

传统Web服务器中(比如`Apache`), 每个HTTP请求都会让服务器创建一个新的进程来处理这个请求

通过Ajax, 我们不需要一次请求整个页面, 而是请求我们需要的部分页面信息, 因此, 我们需要和服务器保持一个长久的有效连接(通常使用长轮询(long polling))

HTTP请求通常不会持续, 每次请求-响应后都会断开连接; 长轮询是一种利用HTTP模拟持续连接的技巧(浏览器主动发送请求至服务器, 等待服务器需要发送信息时, 再返回响应; 可以让浏览器始终保持等待响应的状态);

在传统服务器上, 每次新的用户连接到网站上时, 就需要一个新的连接, 每个连接都占用一个进程(大部分时间是空闲的), 过多的进程会占用过多内存, 可能导致服务器耗光内存

解决方法: 非阻塞和事件驱动

非阻塞像是一个loop循环, 会一直运行; 当有新的请求时, 就会将这个请求传给具体的请求处理程序, 然后响应一个回调. 然后继续运行, 请求处理程序执行完毕后, 就将响应返回浏览器, 然后继续运行. 这样, 服务器进程就不会等待

服务器只有在用户有事件发生时才会响应(事件驱动)

Node.js由JS编写, 使用`Google`的`V8`虚拟机(Chrome浏览器使用的JavaScript执行环境, 负责解释并运行代码; 可以下载该引擎将其嵌入任何应用程序), 来解释和执行`JavaScript`代码. 因为JS本身就是事件驱动的脚本语言(事件处理, 回调).

相对于浏览器环境, Node.js事实上就是另外一种上下文, 允许在后端(脱离浏览器环境)运行JavaScript代码

### 事件驱动编程

连接建立, 数据通过连接传递, 连接关闭,... 都是事件, JS是事件驱动编程语言(闭包, 匿名函数), 所以Node.js很适合进行事件驱动编程

### 优点

在响应客户端之前, 预计可能会有很高的流量, 但所需的服务器端逻辑和处理并不一定很多

典型示例

### Node模块

通过安装模块扩展Node的功能

`Node Package Module`(npm) 内置功能, 用于安装和管理Node模块, 自动处理依赖项

Node 完成了提供高度可伸缩服务器(?)的目标

## Express

* 为不同URL路径使用不同的HTTP动作的请求(路由)编写处理程序
* 集成了`View`渲染引擎(`pug`), 通过将数据插入模板来生成响应
* 设置了常见的Web应用设置, 如用于连接的端口, 以及渲染响应模板的位置
* 在请求处理管道(?)的任何位置添加额外的请求处理"中间件"(接收到请求后, 经过管道到,通过中间件进行处理?)

Express本身是极简的, 但开发人员通过创建各种兼容的中间件包(库)解决了几乎所有的Web开发问题. 这些库可以实现cookie, 会话, 用户登录, URL参数, POST数据, 安全头等功能

一个Web框架是否流行是很重要的, 这预示着它是否会得到持续的维护, 是否会有丰富的文档, 插件库和技术支持

## 固执(opinionated)与包容(unopinionated)

固执的Web框架认为应该有一套标准答案来解决各类具体任务