# Modules 模块

## 模块

模块是一个程序片段, 规定了它依赖的其他部分, 以及它为其他模块提供的功能(interface)

模块之间的关系称为依赖关系(dependencies), 一个模块需要另一个模块的片段时

每个模块需要自己的私有作用域

## 包 Packages

从单独的片段中构建一个程序, 并可以独立运行

packages 可分发(copy&install)的一块代码, 可能包含一个或多个模块, 并且具有关于它依赖于哪些其他包的信息. 还通常附带说明文档

包中发现问题或添加新功能时, 包会更新

使用`NPM`来存储和查找包, 安装和升级

`NPM`

* 下载(上传)包的在线服务
* 帮助安装和管理它们的程序(和`Node.js`绑定

## 即兴的模块(improvised modules)

2015年之前, JS没有内置的模块系统

使用函数创建局部作用域 ,并使用对象来表示模块接口; 将接口放入全局范围, 并且期望它的依赖关系(调用其他函数...)也同样处于全局范围

如果想要依赖关系称为代码的一部分, 我们要控制依赖关系的加载, (需要将字符串执行为代码?)

## 将数据作为代码执行

`eval()` 在当前作用域内执行一个字符串

`Function`构造器

`Function("参数名称", "函数体")` 将代码封装在函数值中, 使其拥有自己的作用域

## CommonJS

用于链接JavaScript模块的最常用方法为CommonJS模块, Node.js使用它, 并且是NPM上大多数包使用的系统

`require()` 是CommonJS最主要的概念, 使用依赖项的模块名称调用这个函数时, 会确保该模块已加载并返回其接口

加载器将模块代码封装在一个函数中, 模块自动得到它们自己的局部作用域. 他们所要做的就是, 调用`require`来访问它们的依赖关系, 并将接口放在绑定到exports的对象中

CommonJS中, 尽管模块系统会为你创建一个空的接口对象(绑定到exports), 但可以通过覆盖`module.exports`来替换它. 很多模块都这么做, 以便导出单个值而不是接口对象

提供给`require`的字符串为实际的文件名或网址(具体方式由系统定义, ./通常为相对于当前模块的文件名)

不是地址时, Node.js将按照名称查找已安装的包

## ECMAScript 模块
CommonJS问题:
* 添加到`exports`的内容在局部作用域不可用
* require是一个正常的函数调用, 接受任何类型参数, 不运行代码就很难确定模块的依赖关系
* 不适合在客户端使用, 要从服务器同步加载模块, 会造成阻塞

ES模块
`Node.js`使用ES模块时, 文件名后缀为`mjs` 版本要>8

`import` 引入模块

```js
import ordinal from "ordinal";
import {days, months} from "date-names";
```

`export` 导出模块

```js
export function formatDate(date, format){
    //do something
}
```

ES模块的接口不是单个值, 而是一组命名绑定, 前面的模块将`formatDate`绑定到一个函数. 另一个模块导入时, 导入绑定(formatDate)而不是值, 意味着导出模块可以随时更改绑定的值

当有一个名为`default`的绑定时, 它将被视为模块的主要导出值? 默认绑定之外仍可以使用不同名称导出其他绑定

在表达式, 函数声明, 类声明之前调用`export default`
```js
export default ["Winter", "Spring", "Summer", "Autumn"];
```

`as` 重命名导入的绑定

```js
import {days as dayNames} from "date-names";

console.log(dayNames.length);
```

ES模块的导入发生在模块的脚本开始运行之前, 因此`import`声明可能不会出现在函数或块中, 并且依赖项的名称只能是带`"`的字符串

## 构建和打包

实际上, 很多`JS`项目都不是用`JS`编写的, 有一些扩张被广泛使用

当网页中要载入大量不同文件组成的模块化程序时, 会消耗大量时间. 通常来说, 加载一个大文件比加载很多小文件要块, 所以会使用工具, 将文件发布到Web之前, 将程序重新组合为一个大文件. 这些工具被称为打包器

也产生了压缩器自动删除文件中的注释和空白, 重命名绑定(缩小变量名), 用占用更少空间的等效代码替换部分代码段等方式, 缩小文件体积

`Webpack`

## 模块设计

通过阅读大量程序来判断哪些设计是有用的, 而哪些则不是

多参照已有的模块设计

使用简单的数据结构执行单一操作, 可以用一个函数能够完成就使用一个函数

通常都需要定义新的数据结构, 但当数组够用时, 就使用数组

## exercise

循环依赖??