# Platform Game

## Levels

'.' => empty
'#' => wall
'+' => lava(岩浆)
'@' => player开始位置
'O' => coin
'=' => 平行移动的lava
'|' => 垂直移动的lava(碰到'#'时, 返回)
'v' => 滴落的lava(垂直向下移动, 但不弹回, 而是重新从初始位置重新移动)

每次游戏包含多个关卡. 每个关卡的硬币收集完后, 关卡完成. 人物触碰岩浆后, 移动到初始位置

FIXME 剩余参数
[...string] => 生成每个字符组成的数组

## 读取Levels

关卡作为字符串, 将字符串分割为一个字符数组(根据`\n`分割每行, 每行再分割为每个字符构成的数组) `[...string]`

将关卡中的可移动元素和背景分离, 将所有可移动的特殊字符放入数组, 从关卡数组中分离出字符

map中传入第二参数作为idx

levelChars[ch] 根据传入的字符`ch`, 返回映射的相关对象

可移动元素存储为Vec object(坐标)

使用State类保存游戏状态

## ACTORS

actors 类存储给定的移动元素的状态和位置, 每个类拥有相同的接口.
Vec class
- pos 属性存储左上角的坐标
- size存储元素尺寸
- update()计算下一次的位置和状态, 并返回新的actor object
- type 包含string类型的actor类型('player', 'coin'...)
- static create() Level object调用, 传入元素的坐标, 元素字符本身('#', '.')创建一个元素
- times() 根据给定的数字进行矢量缩放, 用于乘以一个速度在一定时间内移动的距离

每个不同元素拥有自己的类

### Player

由于Player高度设置为1.5个格子高, 所以初始位置要比@字符的位置高出.5个格子高, 从而使它的底部和底部方格对齐

### lava

****会以一定速度移动, 直到碰到障碍. 此时它可能会重置状态(回复到初始的位置), 或颠倒它的速度, 向相反方向移动
****
### Coin

添加`Wobble`效果, 轻微的上下移动, wobble属性

### levelChars

将Level中特殊字符映射为字符串, 或角色类

## Drawing

### scrollPlayerIntoView

找出角色元素的位置和包裹元素的滚动位置(通过修改scrollLeft, scrollTop), 当元素靠近边缘时, 进行修改

## Action

基本做法: 将时间进行分割, 对于每段时间, 通过元素的速度*时间片段 => 运动距离

解决不同元素之间的相互作用: 物理引擎

## Actors Update

### Lava

新的位置: 时间片段 * 当前速度 + 原有位置

遇到障碍物时('wall'), 根据Lava的类型不同, 有不同的动作(滴落的(this.reset存在)会返回原有位置, 弹跳的则会以相反方向运动)

### Coin



### Player